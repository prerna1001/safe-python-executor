name: "python_sandbox"
description: "Restricts Python script execution"
mode: EXECVE
stderr_to_null: false

envar: "PYTHONPATH=/usr/local/lib/python3.11/site-packages:/usr/local/lib/python3.11/dist-packages"

mount {
  src: "/scripts"
  dst: "/scripts"
  is_bind: true
  is_dir: true
  rw: true
}

mount {
  src: "/tmp"
  dst: "/tmp"
  is_bind: true
  is_dir: true
  rw: true
}

mount {
  src: "/usr"
  dst: "/usr"
  is_bind: true
  is_dir: true
  rw: false
}

mount {
  src: "/lib"
  dst: "/lib"
  is_bind: true
  is_dir: true
  rw: false
}

mount {
  src: "/usr/lib"
  dst: "/usr/lib"
  is_bind: true
  is_dir: true
  rw: false
}

mount {
  src: "/lib64"
  dst: "/lib64"
  is_bind: true
  is_dir: true
  rw: false
  mandatory: false
}

mount {
  src: "/usr/lib64"
  dst: "/usr/lib64"
  is_bind: true
  is_dir: true
  rw: false
  mandatory: false
}

mount {
  src: "/usr/local/lib"
  dst: "/usr/local/lib"
  is_bind: true
  is_dir: true
  rw: false
}

# Mount full site-packages directory recursively to include all files
mount {
  src: "/usr/local/lib/python3.11/site-packages"
  dst: "/usr/local/lib/python3.11/site-packages"
  is_bind: true
  is_dir: true
  rw: false
}

# Mount dynamic libraries required by Python (compiled extensions)
mount {
  src: "/usr/local/lib/python3.11/lib-dynload"
  dst: "/usr/local/lib/python3.11/lib-dynload"
  is_bind: true
  is_dir: true
  rw: false
}

# Optional: mount python stdlib zip (if used)
mount {
  src: "/usr/local/lib/python311.zip"
  dst: "/usr/local/lib/python311.zip"
  is_bind: true
  is_dir: false
  rw: false
}
exec_bin {
  path: "/usr/bin/python3"
  arg: "/scripts/sandboxed.py"
  envar: "OPENBLAS_NUM_THREADS=1"
}

cwd: "/scripts"

clone_newuser: false
clone_newnet: false
